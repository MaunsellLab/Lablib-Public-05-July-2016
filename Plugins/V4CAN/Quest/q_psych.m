/****************** FUNCTION DESCRIPTION ********************USAGE	q_psych(qc, &function, a1, a2, a3, a4);ARGUMENTS	QCondition	*qc				ptr to a condition	double		(*function)()	psychometric function	double		a1				psychometric fcn parameter	double		a2				psychometric fcn parameter	double		a3				psychometric fcn parameter	double		a4				psychometric fcn parameterSUMMARY	Creates (if necessary) and fills the pResponse[] arrays, using the	supplied function and parameters. The supplied function will	be called repeatedly with response, intensity and the four arguments	a1...a4, and is expected to return a probability.		The array created has nnLevels elements. 	The probability p of reponse r at intensity "intensity" is		p = qc->pResponse[r][ vtoii(qc,intensity-actual+guess) ]		where actual is the true threshold and guess is the guess.	RETURN VALUE	None.EXAMPLE	q_psych(qc, &q_Weibull, beta, gamma, delta, epsilon);ERROR HANDLING & BOUNDARY CONDITIONS	Exits if insufficient memory.COMMENTS	The pResponse[r] table is about twice as long as the number of levels so	that it can be used to update the likelihood table p.		See q_Weibull for explanation of the parameters alpha, beta, gamma, delta,	epsilon.	REVISION HISTORY	9/86		Version 1,	A. B. Watson and K. Baldwin	10/16/86	Version 2,	A. Fitzhugh	11/6/87		FW: use double vars everywhere	11/9/87		FW: receive pointer to psych fcn to check if 				memory needs to be allocated 	11/16/87	FW: do not return a pointer; change name of fcn; 				call maketables(); 	12/4/87		FW: do not use success and failure fcns, do not 				call q_make_tables(); 	12/6/87		DGP: removed Weibull function, so that it 				can be called separately.  	12/15/87	DGP: made it accept any psychometric function 				as an argument. 	8/30/91		dgp: modified it to maintain old behavior using new 				pResponse tables.	4/23/92		dgp: now use a PResponseFunction, which accepts an additional				argument specifying the response, in place of the old				PsychometricFunction.	8/10/94		dgp: fixed bug discoved by Metrowerks CodeWarrior compiler. I was				comparing (==) instead of assigning (=) the computed psychometric				function, so q_psych() was not accomplishing anything.*********************************************************/#include <stdio.h>#include "q_include.h"void q_psych(QCondition *qc	,PResponseFunction function,double a1,double a2,double a3,double a4){	int ii;	double intensity;	int nnLevels=qc->nnLevels;	int r;		/* allocate memory if necessary */	for (r=0; r<qc->nResponses; r++) if (qc->pResponse[r]==NULL)		qc->pResponse[r]=(double *) q_erralloc("q_psych",sizeof(double)*nnLevels);			/* intensity, relative to threshold, of 0th element*/	intensity=iitov(qc,0)-qc->guess;		/* Calculate probability for current intensity */	for (ii=0; ii<nnLevels; ii++) {		for(r=0; r<qc->nResponses; r++)			qc->pResponse[r][ii]=(*function)(r,intensity,a1,a2,a3,a4);		intensity+=qc->grain;		/* next intensity */	}}